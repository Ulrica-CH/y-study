# 数据链路层

## 概述

数据链路层和物理层是网络协议栈的基础层，负责数据的物理传输和链路管理。物理层处理比特流的传输，数据链路层负责帧的封装、传输和错误检测。

## 数据链路层功能

### 帧的封装与解封装

- **封装过程**：将网络层数据包封装成帧
- **解封装过程**：接收方解析帧，提取数据包
- **帧结构**：
  - 前导帧（7 字节）
  - 帧开始（1 字节）
  - 目的地址（6 字节）
  - 源地址（6 字节）
  - 类型/长度（2 字节）
  - 数据（46-1500 字节）
  - 帧校验序列（4 字节）

### 物理寻址（MAC 地址）

- **定义**：内置在网卡内的全球唯一地址
- **格式**：48 位二进制，通常分为 6 段，用 16 进制表示
- **作用**：标识计算机身份，确保地址不重复
- **特点**：硬件地址，固化在网卡中

### 差错检测

- **帧校验序列（FCS）**：32 位 CRC 校验值
- **校验范围**：从目的地址到数据字段
- **目的**：检测传输过程中的比特错误

### 流量控制

- **作用**：防止发送方发送过快导致接收方缓冲区溢出
- **机制**：通过控制帧的发送速率实现

## 网络设备

### 交换机

- **功能**：局域网核心设备，提供智能数据转发
- **工作原理**：通过 MAC 地址学习实现高效传输
- **高级功能**：
  - VLAN（虚拟局域网）
  - QoS（服务质量）
  - 端口镜像
  - 链路聚合

### 路由器

- **功能**：连接不同网络，实现网络间通信
- **特点**：基于 IP 地址进行路由决策

## 网络地址转换（NAT）

### SNAT（源地址转换）

- **目的**：将内网设备的源 IP 地址转换为外网 IP 地址
- **应用**：让内网设备能够访问互联网
- **原理**：修改数据包的源地址字段

### NAT 表

- **定义**：记录网络地址转换映射关系的表格
- **内容**：
  - 私有 IP 地址和公有 IP 地址的对应关系
  - 端口映射信息
  - 连接状态信息
- **作用**：维护地址转换的映射关系

## 广播通信

### ARP 协议（地址解析协议）

- **目的**：通过 IP 地址查找对应的 MAC 地址
- **过程**：
  1. 发送 ARP 请求广播
  2. 目标设备回复 MAC 地址
  3. 建立 IP-MAC 映射表

### DHCP 协议（动态主机配置协议）

- **目的**：自动获取 IP 地址配置
- **过程**：
  1. 客户端发送 DHCP 发现广播
  2. 服务器回复 IP 地址等配置信息
  3. 客户端确认并应用配置

## 帧结构详解

### 前导帧

- **内容**：由 1 和 0 交替构成（10101010...）
- **长度**：7 个字节
- **作用**：使 PLS 子层电路与收到的帧达成时钟同步

### 帧开始

- **内容**：10101011
- **长度**：1 个字节
- **作用**：表示一个帧的开始
- **同步机制**：检测到连续的两位 1 时，将后续信息交给 MAC 子层

### 帧校验序列（FCS）

- **内容**：32 位 CRC 校验值
- **长度**：4 个字节
- **计算范围**：从目的地址到数据字段（不包含前导符和帧起始）
- **作用**：检测传输错误

## 总结

数据链路层和物理层是网络通信的基础，物理层负责比特流的传输和信号编码，数据链路层负责帧的封装、传输和错误检测。通过曼彻斯特编码等技术解决了时钟同步和直流分量问题，通过交换机等设备实现了高效的数据转发，通过 NAT 技术解决了地址短缺问题。这些技术共同构建了现代网络通信的基础设施。
